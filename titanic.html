<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>

    <!-- Meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link rel="stylesheet" href="css/style.css">


    <!-- JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
            integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
            crossorigin="anonymous"></script>

    <script src="https://d3js.org/d3.v5.js"
			integrity="sha384-qbNa7U27VV0Cghe/43y8zEMkmA5M4VxV6MI0k0vdVJKTrBoT2SnBqwccpD0vX+Is"
			crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>

    <!--*******************************************-->
    <!--***** IMPORT EXTERNAL JAVASCRIPT CODE *****-->
    <script src="js/barChart.js"></script>
    <script src="js/scatter.js"></script>
    <script src="js/pieChart.js"></script>
    <!--*******************************************-->


    <title>CAP 4744/5745 - Interactive Data Visualization - Project 3</title>

</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="index.html">Project 3: Ayman Nagi</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="iris.html">Iris Dataset</a></li>
            <li class="nav-item active"><a class="nav-link" href="titanic.html">Titanic Passenger List</a></li>
        </ul>
    </div>
</nav>

<div class="page">

    <h1>CAP 4744/5745 - Interactive Data Visualization</h1>
    <h2>Project 3: Titanic Passenger List Dataset</h2>
    <h2>Ayman Nagi</h2>

    <h3>Visualization 1: Univariate</h3>
    <div id="vis_1" name ="vis_1" class="default_svg"> 
    </div>
    <div>
        <p>This visualization's goal is to show the audience what people paid in 1912 for a ticket to board the largest cruise ship in the world, the Titanic. The data is sorted from cheapest to most expensive as indicated in the x-axis label. The x-axis enumerates the passengers to also show how many passengers boarded the Titanic. A viewer can hover over a bar to see the exact value paid by a passenger. A user can also click a bar to see more information on that specific passenger. If the bar is clicked again the view is reset to the original view so they can select a new passenger. When a bar is clicked, visualizations 2 and 3 also change to match the passenger’s gender to give the viewer some insight on male vs female passengers. </p>
        <p>When looking at this bar chart, one could get an idea of the average price a passenger paid to set sail and would notice how very few people paid very high prices. Data is encoded in text boxes when hovered over a bar for better readability. When clicked, more information is available to a viewer via the hover action. Number of passengers and ticket price ranges are encoded on the x and y axis, respectively. </p>
    </div>

    <h3>Visualization 2: Bivariate</h3>
    <button id="all" onClick="xAxis = 'Age';
                              yAxis = 'Fare';
                              vis_2 = scatterPlot('#vis_2', data, xAxis, yAxis);
                              let res = getPieData(data);
                              let pie = res[0];
                              let count = res[1];
                              vis_3 = pieChart('#vis_3', pie, count);">All</button>
    <button id="male" onClick="xAxis = 'Age';
                               yAxis = 'Fare';
                               vis_2 = sexPlot('#vis_2',data, xAxis, yAxis, 'male');
                               let res = getMalePieData(data);
                                let pie = res[0];
                                let count = res[1];
                                vis_3 = pieChart('#vis_3', pie, count);">Male</button>
    <button id="female" onClick="xAxis = 'Age';
                                yAxis = 'Fare';
                                vis_2 = sexPlot('#vis_2',data, xAxis, yAxis, 'female');
                                let res = getFemalePieData(data);
                                let pie = res[0];
                                let count = res[1];
                                vis_3 = pieChart('#vis_3', pie, count);">Female</button>
    <div><svg id="vis_2" name="vis_2" class="default_svg"></svg></div>
    <div>
        <p>This visualization aims to show if there can be any correlation found between age and fare price paid. Buttons above the graph are available to separate the data between male and female to analyze whether gender affected ticket prices. When one button is selected, visualization number 3 also reflects the selected dataset (all, male, or female). Viewers can zoom in on data points for readability by dragging the mouse over a desired area. To zoom back out, a viewer can double click anywhere on the graph. </p>
        <p>Color is used here to encode which points refer to a male or female passenger. Zooming can be used for better analysis and readability. The buttons allow viewers to break down the data for analysis of gender and prices paid. </p>
    </div>

    <h3>Visualization 3: Aggregation</h3>
    <button id="all" onClick="let res = getPieData(data);
                            let pie = res[0];
                            let count = res[1];
                            vis_3 = pieChart('#vis_3', pie, count);
                            xAxis = 'Age';
                            yAxis = 'Fare';
                            vis_2 = scatterPlot('#vis_2', data, xAxis, yAxis);">All</button>
    <button id="male" onClick="let res = getMalePieData(data);
                                let pie = res[0];
                                let count = res[1];
                                vis_3 = pieChart('#vis_3', pie, count);
                                xAxis = 'Age';
                                yAxis = 'Fare';
                                vis_2 = sexPlot('#vis_2',data, xAxis, yAxis, 'male');">Male</button>
    <button id="female" onClick="let res = getFemalePieData(data);
                                let pie = res[0];
                                let count = res[1];
                                vis_3 = pieChart('#vis_3', pie, count);
                                xAxis = 'Age';
                                yAxis = 'Fare';
                                vis_2 = sexPlot('#vis_2',data, xAxis, yAxis, 'female');">Female</button>
    <div id="vis_3" name ="vis_3" class="default_svg"> 
    </div>
    <div>
        <p>This visualization portrays the Titanic's total population and makes it easy to see the ratio of people who survived and did not survive as well as the ratio of men who survived versus women who survived. For more information, users can hover over a “slice” of data and see the category, count, and percentage of the population that corresponds to the selected category. To further break down the data a viewer can select one of the buttons above to see how the male and female populations were affected. When one button is selected, visualization 2 is also changed to reflect the corresponding category (all, male, or female).</p>
        <p>Color is used to separate each “slice” of data for easier viewing and separation of data. When a viewer hovers over a slice, more data can be seen in a text box that appears to better understand each category and how the total population was affected. The buttons allow viewers to understand how gender affected survival rate.</p>
    </div>

</div>


<script>

    /*************************************************/
    /* CODE FOR LOADING AND VISUALIZING DATA */

    let data = null;
    let vis_1 = null;
    let vis_2 = null;
    let vis_3 = null;
    let vis_4 = null;
    
    let xAxis = "";
    let yAxis = "";
    
    // For sorting x-axis variables
    function compare(a,b){ 
        if (a["Fare"] > b["Fare"]){ 
            return 1;
        }
        else{ 
            return -1;
        }
    }

    // Returns map of only needed data for pieChart function to easier parse data
    function getPieData(data){
        let map = {"Male Survived": 0, "Female Survived": 0, "Male Died": 0, "Female Died": 0}
        let count = 0;

        for(const index of data){
            if(index.Survived === "Yes"){
                if(index.Sex == "male"){
                    map["Male Survived"] += 1
                } else{
                    map["Female Survived"] += 1
                }
            }
            else{
                if(index.Sex == "male"){
                    map["Male Died"] += 1
                } else{
                    map["Female Died"] += 1
                }
            }
            count++;
        }
        //console.log("all", map)
        return [map, count]
    }

    function getMalePieData(data){
        let map = {"Survived": 0, "Died": 0}
        let count = 0;

        for(const index of data){
            if(index.Survived === "Yes" && index.Sex == "male"){
                map["Survived"] += 1
                count++;
            }
            else if(index.Survived === "No" && index.Sex == "male"){
                map["Died"] += 1;
                count++;
            }
        }
        //console.log("male", map)
        return [map, count]
    }

    function getFemalePieData(data){
        let map = {"Survived": 0, "Died": 0}
        let count = 0;

        for(const index of data){
            if(index.Survived === "Yes" && index.Sex == "female"){
                map["Survived"] += 1;
                count++;
            }
            else if(index.Survived === "No" && index.Sex == "female"){
                map["Died"] += 1;
                count++;
            }
        }
        //console.log("female", map)
        return [map, count]
    }


    d3.csv("data/titanic_passenger_list.csv", (row, i) => {
        return {
            Name: row.name,
            Survived: (row.survived==1) ? "Yes": "No",
            Sex: row.sex,
            Age: +row.age,
            Fare: +row.fare,
        };
    }).then(rows => {
        xAxis = "Fare";
        rows.sort(compare);
        data = rows;
        vis_1 = titanicBarChart("#vis_1",data, xAxis);

        //xAxis = "Survived"
        //yAxis = "Fare"
        //vis_1 = Old_titanicBarChart("#vis_1", data, xAxis, yAxis)

        xAxis = "Age"
        yAxis = "Fare" 
        vis_2 = scatterPlot("#vis_2", data, xAxis, yAxis)

        let res = getPieData(rows);
        let pie = res[0];
        let count = res[1]
        //console.log(pie, count)
        vis_3 = pieChart("#vis_3", pie, count)
    
    }).catch(error => {
        console.log(error);
    });

    /*************************************************/

</script>

</body>
</html>
